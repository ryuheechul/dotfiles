# vim: set ft=zsh:

# theme for bat
export BAT_THEME="Solarized (light)"

# set LS_COLORS with vivid
if [ -n "${commands[vivid]}" ]; then
  export LS_COLORS=$(vivid generate solarized-light)
fi

# fzf + fd # fd ignores .gitignore files/directories by default
# default
export FZF_DEFAULT_COMMAND='fd --type f'
# color is based on https://github.com/junegunn/fzf/wiki/Color-schemes#solarized-light
export FZF_DEFAULT_OPTS='
  --height 40% 
  --layout=reverse 
  --color fg:240,hl:33,fg+:241,bg+:221,hl+:33
  --color info:33,prompt:33,pointer:166,marker:166,spinner:33
  '

# CTRL-T - Paste the selected files and directories onto the command-line
export FZF_CTRL_T_COMMAND='fd'
export FZF_CTRL_T_OPTS=''

# ALT-C - cd into the selected directory
export FZF_ALT_C_COMMAND='fd -t d'
export FZF_ALT_C_OPTS=''

# better history search with fzf via https://nixos.wiki/wiki/Fzf
if [ -n "${commands[fzf-share]}" ]; then
  source "$(fzf-share)/key-bindings.zsh"
  source "$(fzf-share)/completion.zsh"
else # falling back to brew
  # in case of enabling with brew via https://github.com/junegunn/fzf#using-homebrew
  if type brew &>/dev/null; then
    [ -f ~/.fzf.zsh ] && source ~/.fzf.zsh
    # configuring completions for brew installed packages
    # this FPATH will be needed in ../zshrc and should be accessible this way too
    FPATH=$(brew --prefix)/share/zsh/site-functions:$FPATH
  fi
fi

## binaries by language global packages, for example, npm, rust, go, etc.

# rust
if [ -n "${commands[cargo]}" ]; then
  export PATH="${HOME}/.cargo/bin:${PATH}"
fi

# golang
if [ -n "${commands[go]}" ]; then
  export GOPATH=${HOME}/go
  export PATH=${GOPATH}/bin:${PATH}
fi

# to make it consumable for _evalcache
function _yarnglobalpath {
  echo "echo \"$(yarn global bin)\""
}

# yarn
if [ -n "${commands[yarn]}" ]; then
  # because yarn global bin is slow
  _YARN_GLOBAL_PATH=$(_evalcache _yarnglobalpath)
  export PATH="${_YARN_GLOBAL_PATH}:${PATH}"
fi


ASDF_DIR=${ASDF_DIR:-${HOME}/.asdf}
# https://github.com/asdf-vm/asdf - version manager
[ -f "${ASDF_DIR}/asdf.sh" ] && source "${ASDF_DIR}/asdf.sh"

# starship
_evalcache starship init zsh

# use direnv
[ $commands[direnv] ] && _evalcache direnv hook zsh

# for https://github.com/aykamko/tag
if (( $+commands[tag] )); then
  export TAG_SEARCH_PROG=ag
  tag() { command tag "$@"; source ${TAG_ALIAS_FILE:-/tmp/tag_aliases} 2>/dev/null }
  alias ag=tag
fi


# fallback any command to npx # disabled for now
# source <(npx --shell-auto-fallback zsh)

BASE16_SHELL="${HOME}/.config/base16-shell"
[ -n "${PS1}" ] && \
    [ -s "${BASE16_SHELL}/profile_helper.sh" ] && \
        _evalcache ${BASE16_SHELL}/profile_helper.sh
